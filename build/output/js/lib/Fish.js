(function(){var e=window,f={Version:"0.1.0"};f.$=e.jQuery||e.Zepto||e.$;var n=[].slice,e=f.events={on:function(b,c,a){this._events||(this._events={});(this._events[b]||(this._events[b]=[])).push({callback:c,context:a||this});return this},once:function(b,c,a){var d=this;this.on(b,function(){d.off(b);c.apply(this,arguments)},a)},off:function(b){var c,a,d;if(!b)return this;c={}.toString.call(b)=="[object String]"?[b]:b;for(a=0,d=c.length;a<d;a++)b=c[a],delete this._events[b]},trigger:function(b){if(!this._events)return this;
var c=n.call(arguments,1),a=this._events[b],d=this._events.all;a&&j(a,c);d&&j(d,arguments);return this}},j=function(b,c){var a,d=-1,g=b.length,h=c[0],l=c[1],e=c[2];switch(c.length){case 0:for(;++d<g;)(a=b[d]).callback.call(a.context);break;case 1:for(;++d<g;)(a=b[d]).callback.call(a.context,h);break;case 2:for(;++d<g;)(a=b[d]).callback.call(a.context,h,l);break;case 3:for(;++d<g;)(a=b[d]).callback.call(a.context,h,l,e);break;default:for(;++d<g;)(a=b[d]).callback.apply(a.context,c)}},i=f.Module=function(b,
c){this.attributes={};this.set(b,c)};i.prototype={get:function(b){return this.attributes[b]},del:function(b){delete this.attributes[b];this.trigger("del:"+b,this)},set:function(b,c){var a,d,g,h=[],e=[],f;c||(c={});d=c.silent;g=c.del;h=this.attributes;for(a in b)f=b[a],e.push(a),g?this.del(a):h[a]=f;if(!d)for(a=0;a<e.length;a++)this.trigger("change:"+e[a],this,h[e[a]],c);return this}};var m=f.View=function(b){this.initializer.apply(this,arguments);this.init.apply(this,arguments);this.fn=this.constructor.prototype};
m.prototype={proxy:function(b){return $.proxy(b,this)},include:function(b){$.extend(this.fn,b)},init:function(){},initializer:function(b){for(var c in b)this[c]=b[c];this.elements&&this.refreshElements();this.events&&this.delegateEvents()},$:function(b){this.el||(this.el=$(document.body));return this.el.find(b)},eventSplitter:/^(\w+)\s*(.*)$/,delegateEvents:function(){for(var b in this.events){var c=function(a){return function(b){a||console.log("\u672a\u627e\u5230\u65b9\u6cd5");a($(this),b)}}(this.proxy(this[this.events[b]])),
a=b.match(this.eventSplitter),d=a[1],a=a[2];document.body.ontouchstart===null&&d==="click"&&(d="touchend");a===""?this.el.bind(d,c):this.el.delegate(this[a+"_key"],d,c)}},refreshElements:function(){var b=this,c;for(c in this.elements){var a=this.elements[c];this[a+"_key"]=c;if(a.search(/_rel$/)!==-1){this[a+"Selector"]=c;var d=a.replace(/_rel$/,"");this[a]=function(a,c){return function(){return b[c]=b.$(a)}}(c,d)}else d=this.$(c),this[a]=d}}};i.extend=m.extend=function(b){var c=this,a=function(){c.apply(this,
arguments)};a.prototype=function(a){var b=function(){};b.prototype=a;return new b}(this.prototype);$.extend(a.prototype,b);return a};$.extend(i.prototype,e);window.FishMVC=f})();
