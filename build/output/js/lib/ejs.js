(function(){var d=function(a,b){for(var e=b.exec(a),d=[],c;e!=null;)c=e.index,c!=0&&(a.substring(0,c),d.push(a.substring(0,c)),a=a.slice(c)),d.push(e[0]),a=a.slice(e[0].length),e=b.exec(a);!a==""&&d.push(a);return d},c=function(a,b){for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e])};EJS=function(a){a=typeof a=="string"?{view:a}:a;this.set_options(a);if(a.precompiled)this.template={},this.template.process=a.precompiled,EJS.update(this.name,this);else{if(a.element){if(typeof a.element=="string"){var b=
a.element;a.element=document.getElementById(a.element);if(a.element==null)throw b+"does not exist!";}this.text=a.element.value?a.element.value:a.element.innerHTML;this.name=a.element.id;this.type="["}else if(a.url){a.url=EJS.endExt(a.url,this.extMatch);this.name=this.name?this.name:a.url;var b=a.url,e=EJS.get(this.name,this.cache);if(e)return e;if(e==EJS.INVALID_PATH)return null;try{this.text=EJS.request(b+(this.cache?"":"?"+Math.random()))}catch(c){}if(this.text==null)throw{type:"EJS",message:"There is no template at "+
b};}e=new EJS.Compiler(this.text,this.type);e.compile(a,this.name);EJS.update(this.name,this);this.template=e}};EJS.prototype={render:function(a,b){a=a||{};this._extra_helpers=b;var e=new EJS.Helpers(a,b||{});return this.template.process.call(a,a,e)},update:function(a,b){typeof a=="string"&&(a=document.getElementById(a));if(b==null)return _template=this,function(b){EJS.prototype.update.call(_template,a,b)};typeof b=="string"?(params={},params.url=b,_template=this,params.onComplete=function(b){b=eval(b.responseText);
EJS.prototype.update.call(_template,a,b)},EJS.ajax_request(params)):a.innerHTML=this.render(b)},out:function(){return this.template.out},set_options:function(a){this.type=a.type||EJS.type;this.cache=a.cache!=null?a.cache:EJS.cache;this.text=a.text||null;this.name=a.name||null;this.ext=a.ext||EJS.ext;this.extMatch=RegExp(this.ext.replace(/\./,"."))}};EJS.endExt=function(a,b){if(!a)return null;b.lastIndex=0;return a+(b.test(a)?"":this.ext)};EJS.Scanner=function(a,b,e){c(this,{left_delimiter:b+"%",right_delimiter:"%"+
e,double_left:b+"%%",double_right:"%%"+e,left_equal:b+"%=",left_comment:b+"%#"});this.SplitRegexp=b=="["?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)");this.source=a;this.stag=null;this.lines=0};EJS.Scanner.to_text=function(a){return a==null||a===void 0?"":a instanceof Date?a.toDateString():a.toString?
a.toString():""};EJS.Scanner.prototype={scan:function(a){scanline=this.scanline;regex=this.SplitRegexp;if(!this.source=="")for(var b=d(this.source,/\n/),e=0;e<b.length;e++)this.scanline(b[e],regex,a)},scanline:function(a,b,e){this.lines++;a=d(a,b);for(b=0;b<a.length;b++){var c=a[b];if(c!=null)try{e(c,this)}catch(j){throw{type:"EJS.Scanner",line:this.lines};}}}};EJS.Buffer=function(a,b){this.line=[];this.script="";this.pre_cmd=a;this.post_cmd=b;for(var e=0;e<this.pre_cmd.length;e++)this.push(a[e])};
EJS.Buffer.prototype={push:function(a){this.line.push(a)},cr:function(){this.script+=this.line.join("; ");this.line=[];this.script+="\n"},close:function(){if(this.line.length>0){for(var a=0;a<this.post_cmd.length;a++)this.push(pre_cmd[a]);this.script+=this.line.join("; ");line=null}}};EJS.Compiler=function(a,b){this.pre_cmd=["var ___ViewO = [];"];this.post_cmd=[];this.source=" ";if(a!=null){if(typeof a=="string")a=a.replace(/\r\n/g,"\n"),this.source=a=a.replace(/\r/g,"\n");else if(a.innerHTML)this.source=
a.innerHTML;if(typeof this.source!="string")this.source=""}var b=b||"<",e=">";switch(b){case "[":e="]";break;case "<":break;default:throw b+" is not a supported deliminator";}this.scanner=new EJS.Scanner(this.source,b,e);this.out=""};EJS.Compiler.prototype={compile:function(a,b){a=a||{};this.out="";var e=new EJS.Buffer(this.pre_cmd,this.post_cmd),c="",d=function(a){a=a.replace(/\\/g,"\\\\");a=a.replace(/\n/g,"\\n");return a=a.replace(/"/g,'\\"')};this.scanner.scan(function(a,b){if(b.stag==null)switch(a){case "\n":c+=
"\n";e.push('___ViewO.push("'+d(c)+'");');e.cr();c="";break;case b.left_delimiter:case b.left_equal:case b.left_comment:b.stag=a;c.length>0&&e.push('___ViewO.push("'+d(c)+'")');c="";break;case b.double_left:c+=b.left_delimiter;break;default:c+=a}else switch(a){case b.right_delimiter:switch(b.stag){case b.left_delimiter:c[c.length-1]=="\n"?(c=c.substr(0,c.length-1),e.push(c),e.cr()):e.push(c);break;case b.left_equal:e.push("___ViewO.push((EJS.Scanner.to_text("+c+")))")}b.stag=null;c="";break;case b.double_right:c+=
b.right_delimiter;break;default:c+=a}});c.length>0&&e.push('___ViewO.push("'+d(c)+'")');e.close();this.out=e.script+";";var h="/*"+b+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};",i=0;try{eval(h)}catch(f){if(typeof JSLINT!="undefined")for(JSLINT(this.out);i<JSLINT.errors.length;i++){if(h=JSLINT.errors[i],h.reason!="Unnecessary semicolon."){h.line++;f=Error();f.lineNumber=h.line;f.message=
h.reason;if(a.view)f.fileName=a.view;throw f;}}else throw f;}}};EJS.config=function(a){EJS.cache=a.cache!=null?a.cache:EJS.cache;EJS.type=a.type!=null?a.type:EJS.type;EJS.ext=a.ext!=null?a.ext:EJS.ext;var b=EJS.templates_directory||{};EJS.templates_directory=b;EJS.get=function(a,c){return c==!1?null:b[a]?b[a]:null};EJS.update=function(a,c){a!=null&&(b[a]=c)};EJS.INVALID_PATH=-1};EJS.config({cache:!0,type:"<",ext:".ejs"});EJS.Helpers=function(a,b){this._data=a;this._extras=b;c(this,b)};EJS.Helpers.prototype=
{view:function(a,b,c){if(!c)c=this._extras;if(!b)b=this._data;return(new EJS(a)).render(b,c)},to_text:function(a,b){return a==null||a===void 0?b||"":a instanceof Date?a.toDateString():a.toString?a.toString().replace(/\n/g,"<br />").replace(/''/g,"'"):""}};EJS.newRequest=function(){for(var a=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=0;b<a.length;b++)try{var c=a[b]();if(c!=null)return c}catch(d){}};
EJS.request=function(a){var b=new EJS.newRequest;b.open("GET",a,!1);try{b.send(null)}catch(c){return null}return b.status==404||b.status==2||b.status==0&&b.responseText==""?null:b.responseText};EJS.ajax_request=function(a){a.method=a.method?a.method:"GET";var b=new EJS.newRequest;b.onreadystatechange=function(){if(b.readyState==4)a.onComplete(b)};b.open(a.method,a.url);b.send(null)}})();
EJS.Helpers.prototype.date_tag=function(d,c){c instanceof Date||(c=new Date);for(var a="January,February,March,April,May,June,July,August,September,October,November,December".split(","),b=[],e=[],g=[],j=c.getFullYear(),h=c.getMonth(),i=c.getDate(),f=j-15;f<j+15;f++)b.push({value:f,text:f});for(f=0;f<12;f++)e.push({value:f,text:a[f]});for(a=0;a<31;a++)g.push({value:a+1,text:a+1});b=this.select_tag(d+"[year]",j,b,{id:d+"[year]"});e=this.select_tag(d+"[month]",h,e,{id:d+"[month]"});g=this.select_tag(d+
"[day]",i,g,{id:d+"[day]"});return b+e+g};EJS.Helpers.prototype.form_tag=function(d,c){c=c||{};c.action=d;if(c.multipart==!0)c.method="post",c.enctype="multipart/form-data";return this.start_tag_for("form",c)};EJS.Helpers.prototype.form_tag_end=function(){return this.tag_end("form")};EJS.Helpers.prototype.hidden_field_tag=function(d,c,a){return this.input_field_tag(d,c,"hidden",a)};
EJS.Helpers.prototype.input_field_tag=function(d,c,a,b){b=b||{};b.id=b.id||d;b.value=c||"";b.type=a||"text";b.name=d;return this.single_tag_for("input",b)};EJS.Helpers.prototype.is_current_page=function(d){return window.location.href==d||window.location.pathname==d?!0:!1};
EJS.Helpers.prototype.link_to=function(d,c,a){d||(d="null");a||(a={});if(a.confirm)a.onclick=' var ret_confirm = confirm("'+a.confirm+'"); if(!ret_confirm){ return false;} ',a.confirm=null;a.href=c;return this.start_tag_for("a",a)+d+this.tag_end("a")};
EJS.Helpers.prototype.submit_link_to=function(d,c,a){d||(d="null");a||(a={});a.onclick=a.onclick||"";if(a.confirm)a.onclick=' var ret_confirm = confirm("'+a.confirm+'"); if(!ret_confirm){ return false;} ',a.confirm=null;a.value=d;a.type="submit";a.onclick=a.onclick+(c?this.url_for(c):"")+"return false;";return this.start_tag_for("input",a)};EJS.Helpers.prototype.link_to_if=function(d,c,a,b,e,g){return this.link_to_unless(d==!1,c,a,b,e,g)};
EJS.Helpers.prototype.link_to_unless=function(d,c,a,b,e){b=b||{};return d?e&&typeof e=="function"?e(c,a,b,e):c:this.link_to(c,a,b)};EJS.Helpers.prototype.link_to_unless_current=function(d,c,a,b){a=a||{};return this.link_to_unless(this.is_current_page(c),d,c,a,b)};EJS.Helpers.prototype.password_field_tag=function(d,c,a){return this.input_field_tag(d,c,"password",a)};
EJS.Helpers.prototype.select_tag=function(d,c,a,b){b=b||{};b.id=b.id||d;b.value=c;b.name=d;d="";d+=this.start_tag_for("select",b);for(b=0;b<a.length;b++){var e=a[b],g={value:e.value};if(e.value==c)g.selected="selected";d+=this.start_tag_for("option",g)+e.text+this.tag_end("option")}d+=this.tag_end("select");return d};EJS.Helpers.prototype.single_tag_for=function(d,c){return this.tag(d,c,"/>")};EJS.Helpers.prototype.start_tag_for=function(d,c){return this.tag(d,c)};
EJS.Helpers.prototype.submit_tag=function(d,c){c=c||{};c.type=c.type||"submit";c.value=d||"Submit";return this.single_tag_for("input",c)};EJS.Helpers.prototype.tag=function(d,c,a){a||(a=">");var b=" ",e;for(e in c){var g=c[e]!=null?c[e].toString():"";e=="Class"&&(e="class");b+=g.indexOf("'")!=-1?e+'="'+g+'" ':e+"='"+g+"' "}return"<"+d+b+a};EJS.Helpers.prototype.tag_end=function(d){return"</"+d+">"};
EJS.Helpers.prototype.text_area_tag=function(d,c,a){a=a||{};a.id=a.id||d;a.name=a.name||d;c=c||"";if(a.size)a.cols=a.size.split("x")[0],a.rows=a.size.split("x")[1],delete a.size;a.cols=a.cols||50;a.rows=a.rows||4;return this.start_tag_for("textarea",a)+c+this.tag_end("textarea")};EJS.Helpers.prototype.text_tag=EJS.Helpers.prototype.text_area_tag;EJS.Helpers.prototype.text_field_tag=function(d,c,a){return this.input_field_tag(d,c,"text",a)};
EJS.Helpers.prototype.url_for=function(d){return'window.location="'+d+'";'};EJS.Helpers.prototype.img_tag=function(d,c,a){a=a||{};a.src=d;a.alt=c;return this.single_tag_for("img",a)};
